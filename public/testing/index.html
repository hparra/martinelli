<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<style type="text/css" media="all">
		</style>
		<title>HBOX</title>
		<script src="jquery-1.3.2.js"></script>
		<script src="jquery.json-2.2.js"></script>
		<script type="text/javascript">
			Martinelli = {
				getDevices: function() { // GET /devices
					console.debug("Request: GET /devices")
					$.ajax({
						type: "GET",
						url: "/devices",
						complete: function (xhr, status) {
							if (xhr.status === 200) // "OK"
								console.debug("Response: " + xhr.responseText);
							else
								console.debug("Error");
						}
					});
				},
				putDevice: function() {
					device_name = $("#device_name").val();
					
					// TODO: is there a better way to do this?
					delimeter = $("#delimeter").val().toString()
					delimeter = delimeter.replace(/\\n/, "\n")
					delimeter = delimeter.replace(/\\r/, "\r")
					//delimeter = delimeter.replace(/\\u/, "\u")
					
					// TODO: validation
					put_data = {
						"port": $("#port").val().toString(),
						"baud_rate": parseInt($("#baud_rate").val()),
						"data_bits": parseInt($("#data_bits").val()),
						"stop_bits": parseInt($("#stop_bits").val()),
						"parity_bits": parseInt($("#parity_bits").val()),
						"delimeter": delimeter
					};
					put_data_string = $.toJSON(put_data);
					
					console.debug("Request: PUT /device/" + device_name + "\r\n" + put_data_string);
					
					
					$.ajax({
						type: "PUT",
						url: "/devices/" + device_name,
						contentType: "application/json; charset=UTF-8",
						data: put_data_string,
						complete: function (xhr, status) {
							if (xhr.status === 201) // "Created"
								console.debug("Response: " + xhr.responseText);
							else
								console.debug("Error");
						}
					});
					
				},
				getDevice: function() {
					device_name = $("#get_device_name").val();
					$.ajax({
						type: "GET",
						url: "/devices/" + device_name,
						complete: function (xhr, status) {
							if (xhr.status === 200) // "OK"
								console.debug("Response: " + xhr.responseText);
							else
								console.debug("Error");
						}
					});
				},
				deleteDevice: function() {
					device_name = $("#delete_device_name").val();
					$.ajax({
						type: "DELETE",
						url: "/devices/" + device_name,
						complete: function (xhr, status) {
							if (xhr.status === 200) // "OK"
								console.debug("Response: " + xhr.responseText);
							else
								console.debug("Error");
						}
					});
				}
			};
		</script>
	</head>
	<body>
		<h1>Martinelli Testing</h1>
		<div class="section">
			<h2>/devices</h2>
			<a href="#" onclick="Martinelli.getDevices()">GET /devices</a><br />
			
			<a href="#" onclick="Martinelli.putDevice()">PUT /devices/</a><input type="text" id="device_name" name="device_name" /><br />
			<ul>
				<li>Port: <input type="text" id="port" name="port" /></li>
				<li>Baud Rate: <input type="text" id="baud_rate" name="baud_rate" /></li>
				<li>Data Bits: <input type="text" id="data_bits" name="data_bits" /></li>
				<li>Stop Bits: <input type="text" id="stop_bits" name="stop_bits" /></li>
				<li>Parity Bits: <input type="text" id="parity_bits" name="parity_bits" /></li>
				<li>Delimeter: <input type="text" id="delimeter" name="delimeter" /></li>
			</ul>
			<a href="#" onclick="Martinelli.getDevice()">GET /devices/</a><input type="text" id="get_device_name" name="get_device_name" /><br />
			<a href="#" onclick="Martinelli.deleteDevice()">DELETE /devices/</a><input type="text" id="delete_device_name" name="delete_device_name" /><br />
		</div>
	</body>
</html>